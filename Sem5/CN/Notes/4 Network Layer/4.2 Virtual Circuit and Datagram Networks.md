Network layer also provides connection-less or connection-oriented services between two hosts but they are different from transport layer as -
- In the network layer these services are host-to-host services provided by the network layer by the transport layer. In transport layer services are process-to-process provided by transport layer for application layer.
- Network layer would either provide connection-less services or connection-oriented services while transport layer could provide both of the services over the same network layer.
- Transport layer's services are built at the network edge in the end systems, Network layer's services are built in the routers in the network core as well as in end systems.
### 4.2.1 Virtual-Circuit Networks
It is the connection-oriented service offered by the network layer. A VC consists of -
- **Path** : between the hosts
- **VC number** : one number for each link along the path
- **Entries** in forwarding table in each router along the path

A packet belonging to a VC will carry a VC Number in its header. AS VCs may have different VC numbers at each link every router should replace the VC number of each traversing packet with a new VC number.
![[4.3.png]]

###### Q)Why cant they have a common VC number for each path?
- Replacing the VC number from link to link reduces the length of the VC field in the packet header.
- If a common VC has to be decided then the routers have to exchange many messages to decide on a common VC number that is not used for any other connection.

Each time a new connection is established across a router, a new connection entry must be added to the router's forwarding table and each time it is released, an entry should be removed from the table.

There are three phases in a virtual circuit -
- **VC setup** : The transport layer contacts the network layer, specifies the receiver's address and waits for the network to setup the VC. The network layer finds the route through which the packets would travel. It also determines the VC number along the path and adds an entry in the forwarding table of each router along the path. During the VC setup network layer may reserve resources along the path of the VC.
- **Data transfer** : Packets can now begin to flow.
- **VC teardown** : This is initiated when the sender or receiver wants to terminate the VC. The network layer then informs the end system on the other side and updates the forwarding tables of every router on the path indicating that the VC no longer exists.

The messages end systems send into network to initiate or terminate a VC is called **signaling messages** and the protocols are called **signaling protocols**.
![[4.4.png]]
### 4.2.2 Datagram Networks
In a **Datagram** network the end system stamps the packet with the address of the destination and puts it into the network. The routers have **forwarding table** which maps destination address to the correct output link of the router.
![[4.5.png]]
###### Forwarding table Techniques :
- **Brute Force** - Keep one entry for every possible destination address. <font color="#c00000">Since there are around 4 billion possible addresses, this option isn't possible</font>
  ![[ex1.png]]
- **Longest prefix match** - The forwarding table has prefixes and output link as pairs. It matches the prefixes to the destination address of the packet and sends the packet into the correct output link. If there are multiple matches, it sends the packet to the output link of the longest prefix that was matched.
  ![[ex2.png]]
Although the datagram network maintains no connection state information, they maintain forwarding state information in their forwarding tables. The forwarding tables are modified by the routing algorithms every 1-5 mins hence are relatively slow. Because forwarding tables can be modified at any time a series of packets sent from one end to the other would follow different paths through the network and may arrive out of order.
### 4.2.3 Origins of VC and Datagram Networks
The evolution of datagram and virtual circuit (VC) networks reflects their origins. VC networks grew from the telephony model, where real circuits were used, requiring call setup and per-call state at routers. This made the network complex, while end systems like rotary telephones remained simple. In contrast, datagram networks such as the Internet emerged to connect computers, which are intelligent end systems. The Internet design therefore kept the network layer simple with minimal or no service guarantees, while shifting advanced features like reliability, ordering, congestion control, and DNS to higher layers at the end systems. This inversion made the network lightweight and imposed minimal requirements, enabling easier interconnection of heterogeneous link technologies such as satellite, Ethernet, fiber, and radio. It also allowed rapid deployment of new services and applications, since adding a host and defining a new application-layer protocol (e.g., HTTP, DNS, email, Web) was sufficient to extend functionality. Thus, VC networks rely on complex networks with simple devices, while datagram networks rely on simple networks with smart end systems.