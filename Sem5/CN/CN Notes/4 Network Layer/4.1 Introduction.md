The network layer takes segments from transport layer, encapsulates each segment into a datagram and then sends it to its nearby router. At the destination it receives the datagram from its nearby router, extracts the transport layer segments and delivers it to the transport layer. 

### 4.1.1 Forwarding and Routing
The network layer's role is to move packets from one host to the other. to do this there are two major functions -
#### Forwarding :
When a packet arrive a router's input link it moved it to the appropriate output link, this is called forwarding.
#### Routing :
The network layer determines the path packets will take as they flow from sender to receiver. The algorithms that calculate them are called routing algorithms.

- Every router has a **Forwarding table**. A router forwards a packet by examining the value of the arriving packet's header and using this value as index in the forwarding table, the value in the forwarding table indicates the router output link interface to which the packet is to be sent.![[4.1.png]]
  **Centralized** : Algorithm runs on a central site and downloading routine information in each of the routers.
  **Decentralized** : Distributed algorithm on each of the routers.
- Network layer also has an important function of **setting** up the **connection**

### 4.1.2 Network Service Models
The services that network layer gives to the transport layer are - 
- **Guaranteed delivery** : This service guarantees that the packet will eventually arrive at its destination.
- **Guaranteed delivery with bounded delay** : This service not only guarantees delivery of the packet, but delivery within a specified host-to-host delay bound.

Furthermore considering a flow of packets -
- **In-order packet delivery** : This service guarantees that packets arrive at the destination in the order that they were sent.
- **Guaranteed minimal bandwidth** : This network-layer service emulates the behavior of a transmission link of a specified bit rate between sending and receiving hosts. As long as the sending host transmits bits at a rate below the specified bit rate, then no packet is lost and each packet arrives within a prespecified host-to-host delay.
- **Guaranteed maximum jitter** : This service guarantees that the amount of time between the transmission of two successive packets at the sender is equal to the amount of time between their receipt at the destination.
- **Security services** : Using a secret session key known only by a source and destination host, the network layer in the source host could encrypt the payloads of all datagrams being sent to the destination host. The network layer in the destination host would then be responsible for decrypting the payloads. With such a service, confidentiality would be provided to all transport layer segments(TCP and UDP) between the source and destination hosts. In addition to confidentiality, the network layer could provide data integrity and source authentication services.

These were some examples, network layer could have many more services. Internet's network layer provides only one service **best-effort service**, which basically is no service at all.
Other network architectures have defines network layers- 
- **Constant bit rate(CBR) ATM network service** : It was the first ATM service to be standardized. With CBR a flow of ATM cells is carried across the network in such a way that a cell's end to end delay, jitter, the fraction of cells that are lost or delivered late are all guaranteed  to be less than a value. This value was decides by the sending host and the ATM network when CBR connection as first established.
- **Available bit rate(ABR) ATM network service** : It is a **better-than-best-effort** model. Like the Internetâ€™s best-effort service, cells may be lost, but unlike the Internet, they are never delivered out of order. ABR guarantees a **minimum cell rate (MCR)**, while allowing higher rates if network resources are available. It also provides **feedback to the sender** (through congestion notifications or explicit rate instructions), helping the sender adjust its transmission rate between the guaranteed MCR and the peak rate.
![[4.2.png]]